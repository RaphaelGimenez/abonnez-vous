{# filepath: templates/subscription/index.html.twig #}
{% SubscriptionStatus = enum('App\\Enum\\SubscriptionStatus') %}
{% extends 'base.html.twig' %}
{% block title %}
	Choisissez votre offre
{% endblock %}

{% block javascripts %}
	{{ parent() }}<script type="module" src="{{ asset('subscription.js') }}"></script>
{% endblock %}

{% block body %}
	<div class="container mx-auto my-12 px-4 max-w-6xl">
		<h1 class="text-4xl font-bold text-center mb-12 uppercase">Choisissez votre offre</h1>


		{% for message in app.flashes('success') %}
			<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
				<span class="block sm:inline">{{ message }}</span>
				<button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
					<span class="text-2xl">&times;</span>
				</button>
			</div>
		{% endfor %}

		{% for message in app.flashes('error') %}
			<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
				<span class="block sm:inline">{{ message }}</span>
				<button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
					<span class="text-2xl">&times;</span>
				</button>
			</div>
		{% endfor %}

		{% if userPlan %}
			<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-6" role="alert">
				<span class="block sm:inline">Vous êtes actuellement abonné au plan
					<strong>
						{{ userPlan.name }}
						{% if userSubscription.billingPeriod == SubscriptionStatus::YEARLY %}
							annuel
						{% else %}
							mensuel
						{%- endif -%}
					</strong>.
				</span>
				<a href="{{ manageUrl }}" class="underline">Gérez votre abonnement.</a>

			</div>
		{% endif %}

		<div class="flex justify-center mb-8">
			<div class="inline-flex rounded-lg border border-gray-300 bg-gray-100 p-1" role="tablist" aria-label="Période de facturation">
				<button id="monthlyBtn" class="px-6 py-2 rounded-md bg-white shadow-sm font-semibold text-cyan-600 transition duration-200" role="tab" aria-selected="true" aria-controls="pricing-panel">
					Mensuel
				</button>
				<button id="annualBtn" class="px-6 py-2 rounded-md font-semibold text-gray-600 transition duration-200" role="tab" aria-selected="false" aria-controls="pricing-panel">
					Annuel
				</button>
			</div>
		</div>

		<div id="pricing-panel" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-xl mx-auto" role="tabpanel">
			{% for plan in plans %}
				<div class="border border-gray-200 rounded-lg overflow-hidden">
					<div class="text-center text-cyan-600 py-4">
						<h3 class="text-xl font-semibold">{{ plan.name }}</h3>
					</div>
					<hr class="border-cyan-100 w-[90%] mx-auto">
					<div class="text-center py-8">
						<h2 class="text-2xl font-bold text-gray-800">
							<span class="price-monthly">{{ plan.monthlyPrice }}€</span>
							<span class="price-annual hidden">{{ plan.annualPrice }}€</span>
						</h2>
						<p class="text-gray-600 mt-2">
							<span class="price-monthly">par mois</span>
							<span class="price-annual hidden">par an</span>
						</p>
					</div>
					<div class="bg-transparent text-center pb-6 px-4">
						<form method="post" action="{{ path('app_subscription_subscribe', {id: plan.id}) }}" class="subscription-form">
							<input type="hidden" name="_token" value="{{ csrf_token('subscribe' ~ plan.id) }}">
							<input type="hidden" name="billing_period" value="monthly" class="billing-period-input">
							<button type="submit" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed" {% if userPlan %} disabled {% endif %}>
								Je m'abonne
							</button>
						</form>
					</div>
				</div>
			{% else %}
				<div class="col-span-full">
					<p class="text-center text-gray-600 text-lg">
						Aucune offre disponible pour le moment. Veuillez revenir plus tard.
					</p>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
