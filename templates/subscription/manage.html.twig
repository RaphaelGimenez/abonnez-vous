{% extends 'base.html.twig' %}
{% set SubscriptionStatus = enum('App\\Enum\\SubscriptionStatus') %}
{% block title %}
	Gérez votre abonnement
{% endblock %}

{% block javascripts %}
	{{ parent() }}<script type="module" src="{{ asset('subscriptionManage.js') }}"></script>
{% endblock %}

{% block body %}
	<div class="container mx-auto my-12 px-4 max-w-4xl">
		<h1 class="text-4xl font-bold text-center mb-12 uppercase">Gérez votre abonnement</h1>

		{% for message in app.flashes('success') %}
			<div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
				<span class="block sm:inline">{{ message }}</span>
				<button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
					<span class="text-2xl">&times;</span>
				</button>
			</div>
		{% endfor %}

		{% for message in app.flashes('error') %}
			<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
				<span class="block sm:inline">{{ message }}</span>
				<button type="button" class="absolute top-0 bottom-0 right-0 px-4 py-3" onclick="this.parentElement.remove()">
					<span class="text-2xl">&times;</span>
				</button>
			</div>
		{% endfor %}

		{% if subscription.status == SubscriptionStatus.CANCELED %}
			<div class="bg-orange-100 border border-orange-400 text-orange-700 px-4 py-3 rounded relative mb-6" role="alert">
				<span class="block sm:inline">Votre abonnement n'est plus actif et prendra fin le
					{{ subscription.endDate ? subscription.endDate|date('d/m/Y') : '' }}.</span>
			</div>
		{% elseif subscription.status == SubscriptionStatus.ACTIVE %}
			<div class="bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded relative mb-6" role="alert">
				<span class="block sm:inline">Vous pouvez annuler votre abonnement à tout moment. En l'annulant, vous conserverez l'accès à votre plan actuel jusqu'à la fin de la période de facturation en cours.</span>
			</div>
		{% elseif subscription.status == SubscriptionStatus.RENEWING %}
			<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative mb-6" role="alert">
				<span class="block sm:inline">Votre abonnement a été renouvelé et reprendra automatiquement à la fin de la période en cours.</span>
			</div>
		{% endif %}


		{% if subscription.status == SubscriptionStatus.ACTIVE or subscription.status == SubscriptionStatus.RENEWING %}
			<form method="post" action="{{ path('app_subscription_cancel') }}" data-testid="cancel-subscription-form">
				<input type="hidden" name="_token" value="{{ csrf_token('cancel_subscription') }}">

				<button type="submit" {% if subscription.status == SubscriptionStatus.CANCELED %} disabled {% endif %} class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded disabled:bg-gray-400 disabled:cursor-not-allowed">
					Annuler mon abonnement
				</button>
			</form>
		{% endif %}

		{% if subscription.status == SubscriptionStatus.CANCELED %}
			<form method="post" action="{{ path('app_subscription_renew') }}" class="mt-4" data-testid="renew-subscription-form">
				<input type="hidden" name="_token" value="{{ csrf_token('renew_subscription') }}">

				<button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
					Reprendre mon abonnement
				</button>
			</form>
		{% endif %}


	</div>
{% endblock %}
